cat > Makefile <<'EOF'
APP := sdprep
SRC := sdprep.c
RESXML := sdprep.gresource.xml
RESC := sdprep-resources.c

# Default to GTK3; override with: make GTK=4
GTK ?= 3
ifeq ($(GTK),4)
PKGS := gtk4 json-c
else
PKGS := gtk+-3.0 json-c
endif

CFLAGS := -O2 -Wall -Wextra $(shell pkg-config --cflags $(PKGS))
LIBS   := $(shell pkg-config --libs $(PKGS))

all: $(APP)

$(RESC): $(RESXML) icons/sdprep.png
	glib-compile-resources $(RESXML) --generate-source --target=$(RESC)

$(APP): $(SRC) $(RESC)
	gcc -o $(APP) $(SRC) $(RESC) $(CFLAGS) $(LIBS)

clean:
	rm -f $(APP) $(RESC)

.PHONY: all clean
EOF

